<!DOCTYPE HTML>
<html>
<head>
	<meta charset="UTF-8">
	<title>Custom Scrolling</title>
	<style type="text/css">
	body {
		color: #111;
		font-size: 16px;
		font-family: "Helvetica", "Arial", sans-serif;
	}
	div, p {
		margin: 0;
		padding: 0;
	}
	.wrapper {
		margin: 0 auto 20px auto;
		width: 440px;
	}
	#intro p {
		color: #666;
		line-height: 1.5;
	}
	.scroll {
		position: absolute;
		left: 0;
		top: 0;
	}
	.bounds {
		position: relative;
		overflow: hidden;
		border: 1px solid #ccc;		
	}
	.content {
		margin: .5em 1em;
	}
	.content p {
		margin-bottom: 1em;
	}
	#hbounds {
		margin-bottom: 1em;
		height: 2em;
		width: 100%;
	}
	#hcontent {
		width: 200em;
	}
	#vbounds {
		margin-bottom: 1em;
		height: 12em;
		width: 100%;
	}
	.controls {
		text-align: center;
		margin-bottom: 1em;
	}
	label {
		color: #666;
		font-size: .75em;
		font-weight: bold;
	}
	</style>
	<script src="http://ajax.googleapis.com/ajax/libs/dojo/1.4/dojo/dojo.xd.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
	<div id="intro" class="wrapper">
		<h1>Simple Custom Scrolling</h1>

		<p>This is a quick implementation of custom scrolling without native
			scrollbars. Click the left and right buttons to scroll the content, or use
			your mouse scroll wheel (works with an Apple Magic/Mighty Mouse horizontal scrolling as well)</p>
	</div>	
	<!-- To control the position of one div within another, use an 
	absolute div within a relative (or an absolute within an absolute) -->
	<div id="demo" class="wrapper">
		<div id="hbounds" class="bounds">
			<div id="hscroll" class="scroll">
				<div id="hcontent" class="content">
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</div>
			</div>
		</div>
		<div class="controls">
			<p><button id="left">&laquo; Scroll left</button>
			<button id="right">Scroll right &raquo;</button></p>			
		</div>
		<div id="vbounds" class="bounds">
			<div id="vscroll" class="scroll">
				<div id="vcontent" class="content">
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</div>
			</div>
		</div>
		<div class="controls">
			<p><button id="up">Scroll up</button></p>
			<p><button id="down">Scroll down</button></p>			
		</div>
		<div class="controls">
			<p><label for="speed">Speed</label><select id="speed">
				<option value="1" selected>Slow</option>
				<option value="4">Medium</option>
				<option value="8">Fast</option>
				<option value="32">Really Fast</option>
			</select>
			<label for="acceleration">Acceleration</label><input type="checkbox" name="acceleration" value="" checked="checked" id="acceleration"></p>
		</div>
	</div>
	<script type="text/javascript">
	var dxStep = 1, // Initial x speed
		dyStep = 1, // Initial y speed
		dxMax = 16, // Max x speed
		dyMax = 24, // Max y speed
		accel = 1.05; // Poor man's acceleration multiplier
		
	function getBounds(boundNode) {
		var boundsBox = dojo.marginBox(boundNode),
			scrollBox = dojo.marginBox(dojo.query('.scroll', boundNode)[0]);
			
		return {l: boundsBox.w - scrollBox.w, t: boundsBox.h - scrollBox.h};
	}
	
	function getWheelDeltas(e) {
		var direction = (!dojo.isMozilla ? 1 : -1),
			dx = e[(!dojo.isMozilla ? "wheelDelta" : "detail")],
			dy = dx;
		if(typeof e.wheelDeltaX != "undefined") {
			dx = e.wheelDeltaX * .1;
			dy = e.wheelDeltaY * .1;
		}
		
		return { dx: dx * direction, dy: dy * direction };
	}
		
	dojo.ready(function() {
		var acceleration = true,
			moveTimer,
			hscroll = dojo.byId('hscroll'),
			hbounds = getBounds(dojo.byId('hbounds')),
			vscroll = dojo.byId('vscroll'),
			vbounds = getBounds(dojo.byId('vbounds'));
		
		// Sets up a timer that will periodically move the scroll content
		// and calculate acceleration if necessary.  Call with dx=0 to cancel
		function checkMove(node, bounds, dx, dy) {
			if(dx != 0 || dy != 0) {
				// Could handle both dx and dy here if vertical and horizontal
				// scrolling are needed
				moveTimer = setTimeout(function() {
					move(node, bounds, dx, dy);
					// simple acceleration via multiplier
					if(acceleration) {
						if(dx != 0 && Math.abs(dx) < dxMax) dx = dx * accel;
						if(dy != 0 && Math.abs(dy) < dyMax) dy = dy * accel;
					} 
					checkMove(node, bounds, dx, dy);
				}, 20); // 20 seems to be smooth enough, 10 accelerates too quickly, imho
			} else {
				clearTimeout(moveTimer);
			}
		}
		
		// Actually moves the scroll content
		function move(node, bounds, dx, dy) {
			var p = dojo.marginBox(node);
			node.style.left = Math.min(0, Math.max(bounds.l, p.l + dx)) + "px";
			node.style.top = Math.min(0, Math.max(bounds.t, p.t + dy)) + "px";
		}

		// Instead of moving the div directly, use the mousedown/up to
		// set the current "mode" or scroll amount, and let a timeout
		// do the actual moving.
		// could also use dojo.animateProperty for some snazz, but this is
		// simpler.
		dojo.query('#right')
		.onmousedown(function(e) { checkMove(hscroll, hbounds, -dxStep, 0); })
		.onmouseup(function(e) { checkMove(hscroll, hbounds, 0, 0); move(hscroll, hbounds, -dxStep, 0); });

		dojo.query('#left')
		.onmousedown(function(e) { checkMove(hscroll, hbounds, dxStep, 0); })
		.onmouseup(function(e) { checkMove(hscroll, hbounds, 0, 0); move(hscroll, hbounds, dxStep, 0); });

		dojo.connect(hscroll, (!dojo.isMozilla ? "onmousewheel" : "DOMMouseScroll"), function(e){
			// except the direction is REVERSED, and the event isn't normalized! one more line to normalize that:
			var dist = getWheelDeltas(e);
			// might need to temper the speed with a scroll wheel multiplier
			// < 1 here, e.g. dist * .5 or .1 or whatever
			move(hscroll, hbounds, dist.dx, 0);
			// This prevents the browser from also scrolling the window viewport if there is
			// a scrollbar on the window.
			dojo.stopEvent(e);
		});
		
		dojo.query('#down')
		.onmousedown(function(e) { checkMove(vscroll, vbounds, 0, -dyStep); })
		.onmouseup(function(e) { checkMove(vscroll, vbounds, 0, 0); move(vscroll, vbounds, 0, -dyStep); });

		dojo.query('#up')
		.onmousedown(function(e) { checkMove(vscroll, vbounds, 0, dyStep); })
		.onmouseup(function(e) { checkMove(vscroll, vbounds, 0, 0); move(vscroll, vbounds, 0, dyStep); });
		
		dojo.connect(vscroll, (!dojo.isMozilla ? "onmousewheel" : "DOMMouseScroll"), function(e){
			console.log(e);
			// except the direction is REVERSED, and the event isn't normalized! one more line to normalize that:
			var dist = getWheelDeltas(e);
			// might need to temper the speed with a scroll wheel multiplier
			// < 1 here, e.g. dist * .5 or .1 or whatever
			move(vscroll, vbounds, 0, dist.dy);
			// This prevents the browser from also scrolling the window viewport if there is
			// a scrollbar on the window.
			dojo.stopEvent(e);
		});
		
		// Handle settings
		dojo.query('#acceleration').onchange(function(e) { acceleration = e.target.checked; });
		dojo.query('#speed').onchange(function(e) { dxStep = dyStep = 1*e.target.value; });
	});
	</script>
</body>
</html>